# 네트워크

## 네트워크 : 컴퓨터, 장치 또는 시스템이 상호 연결되어 통신할 수 있는 구조

- 노드와 링크가 서로 연결되어 있으며 리소스를 공유하는 집합
  
  - 노드 - 서버, 라우터, 스위치 등 네트워크 장치
    
  - 링크 - 유선/무선
    

### 1. 네트워크의 기초

#### 1-1. 처리량과 지연 시간

##### 트래픽(Traffic) : 특정 시점에 링크 내에 흐르는 데이터의 양

##### 처리량(Throughput) : 링크 내에서 성공적으로 전달된 데이터의 양

##### 지연 시간(Latency) : 요청이 처리되는 시간

- 매체타입(유선/무선), 패킷 크기, 라우터의 패킷 처리 시간에 영향을 받음

> **참고**
> - 트래픽이 많아졌다. = 흐르는 데이터가 많아졌다.
>   
> - 처리량이 많아졌다. = 처리되는 트래픽이 많아졌다.
>   

#### 1-2. 네트워크 토폴로지와 병목 현상

##### 네트워크 토폴로지 : 노드와 링크가 어떻게 배치되어 있는지에 대한 방식이자 연결 형태

- 트리, 버스, 스타, 링형, 메시 토폴로지가 존재

##### 병목 현상 : 전체 시스템의 성능이나 용량이 하나의 구성 요소로 인해 제한을 받는 현상

- 주요 원인
  
- 네트워크 대역폭
  
- 네트워크 토폴로지
  
- 서버 CPU, 메모리 사용량
  
- 비효율적인 네트워크 구성
  

#### 1-3. 네트워크 분류

- LAN : 근거리 통신망(건물이나 캠퍼스 같은 좁은 공간)
  
  - 전송 속도가 빠르고 혼잡하지 않음
- MAN : 대도시 지역 네트워크(도시 같은 넓은 지역)
  
  - 전송속도가 평균이고 LAN보다 혼잡
- WAN : 광역 네트워크(국가 또는 대륙 같은 더 넓은 지역)
  
  - 전송 속도가 낮고 MAN보다 혼잡

#### 1-4. 네트워크 성능 분석 명령어

- ping : 네트워크 상태를 확인하려는 대상 노드를 향해 일정 크기의 패킷을 전송하는 방법
  
- netstat, nslookup, tracert
  

#### 1-5. 네트워크 프로토콜 표준화

##### 네트워크 프로토콜 : 다른 장치들끼리 데이터를 주고받기 위해 설정된 공통된 인터페이스

ex) HTTP 프로토콜을 통해 노드들은 웹 서비스를 기반으로 주고받기 가능

### 2. TCP/IP 4계층 모델

#### 2-1. 계층 구조

> ##### 애플리케이션 계층
> 
> FTP, HTTP, SSH, SMTP, DNS 등 응용 프로그램이 사용되는 프로토콜 계층이며 웹 서비스, 이메일 등 서비스를 실질적으로 사람들에게 제공하는 층

> ##### 전송 계층
> 
> 송신자와 수신자를 연결하는 통신 서비스를 제공하는 층
> 
> - TCP - 패킷 사이의 순서를 보장하고 '가상회선 패킷 교환 방식' 사용
>   
>   - 가상회선 패킷 교환 방식 : 데이터 전송 전에 논리적 연결이 설정되고 각 패킷에 가상회선 식별자가 포함되서 모든 패킷을 전송하면 가상회선이 해제되고 패킷들은 전송된 순서대로 도착하는 방식
>     
>   - TCP 연결 성립 과정 - 신뢰성을 확보할 때, 3 - 웨이 핸드셰이크
>     
>     - 3 - 웨이 핸드셰이크
>       
>     - 1. SYN 단계
>         
>         클라이언트는 서버에 클라이언트의 ISN을 담아 SYN을 보낸다. ISN은 새로운 TCP 연결의 첫 번째 패킷에 할당된 임의의 시퀀스 번호를 말하며 이는 장치마다 다를 수 잇다.
>         
>       2. SYN + ACK 단계
>         
>         서버는 클라이언트의 SYN을 수신하고 서버의 ISN을 보내며 승인번호로 클라이언트의 ISN + 1을 보낸다.
>         
>       3. ACK 단계
>         
>         클라이언트는 서버의 ISN + 1한 값인 승인번호를 담아 ACK를 서버에 보낸다.
>         
>   - TCP 연결 해제 과정 - 4 - 웨이 핸드셰이크
>     
>     - 1. 먼저 클라이언트가 연결을 닫으려고 할 떄, FIN으로 설정된 세그먼트를 보낸다. 그리고 클라이언트는 FIN_WAIT_1 상태로 들어가고 서버의 응답을 기다린다.
>         
>       2. 서버는 클라이언트로 ACK라는 승인 세그먼트를 보낸다. 그리고 CLOSE_WAIT 상태에 들어간다. 클라이언트가 세그먼트를 받으면 FIN_WAIT_2 상태에 들어간다.
>         
>       3. 서버는 ACK를 보내고 일정 시간 이후에 클라이언트에 FIN이라는 세그먼트를 보낸다.
>         
>       4. 클라이언트는 TIME_WAIT 상태가 되고 다시 서버로 ACK를 보내서 서버는 CLOSED 상태가 된다. 이후 클라이언트는 어느 정도의 시간을 대기한 후 연결이 닫히고 클라이언트와 서버의 모든 자원의 연결이 해제된다.
>         
> - UDP - 패킷 사이의 순서를 보장하지 않고 '데이터그램 패킷 교환 방식' 사용
>   
>   - 데이터그램 패킷 교환 방식 : 데이터 전송 전에 논리적 연결이 설정되지 않고 패킷이 독립적으로 전송되서 도착 순서가 다를 수 있는 방법
>     

> ##### 인터넷 계층
> 
> 장치로부터 받은 네트워크 패킷을 IP 주소로 지정된 목적지로 전송하기 위해 사용되는 계층.
> 
> IP, ARP, ICMP 등이 있고 패킷을 수신해야 할 상대의 주소를 지정하여 데이터 전달.

> ##### 링크 계층
> 
> 전선, 광섬유, 무선 등으로 실질적으로 데이터를 전달하며 장치 간에 신호를 주고받는 규칙을 정하는 계층.
> 
> - PDU : 네트워크의 어떠한 계층에서 계층으로 데이터가 전달될 때 한 덩어리의 단위
>   

### 3. 식별자

식별자 - port번호, MAC 주소, IP 주소

- MAC 주소
  
  - 2계층(HW)에서 NIC(LAN 카드)에 대한 식별자
  - LAN 카드는 유선/무선이 있으므로 어떤 노트북의 NIC이 2개라면 MAC 주소도 2개
  - MAC 주소는 HW 주소인데 변경 가능하다.
- IP 주소
    
  - 3계층(네트워크)에서 host에 대한 식별자
    - Host
      - 인터넷(네트워크)에 연결된 컴퓨터
  - NIC 하나가 IP 주소 여러개를 가질 수 있다.
- Port 번호
  
  - 4계층(전송)에서 프로세스 or 서비스 or 인터페이스에 대한 식별자(어떤 계층에서 일하는 사람인가에 따라 3개중 하나로 생각할 수 있음)

Host

- 네트워크 이용주체 - 역할: End Point(단말)
  - Peer, Server, Client
- 네트워크 자체 - 역할: Switch
  - IP 주소를 가지고 스위치하면 L3 스위치 - Router
  - Port 번호를 가지고 스위치하면 L4 스위치

인터넷 - Router + DNS

IP 주소 체계(192.168.60.14 예시)

192.168.60.14라고 있을 때, 앞에 있는 부분을 네트워크 주소(ID), 뒤에 있는 부분을 호스트 주소(ID)(총 길이 32)

클래스별로 어디까지를 네트워크 주소로 할지 다르다.

IP 주소에서 네트워크 주소의 길이를 나타내는 것이 (서브)넷 마스크 - 255.255.255.0

네트워크 부분은 1로, 호스트 부분은 0으로 표시

- IPv4
  - 1바이트 당 8비트씩 총 32비트
- IPv6

IP 주소와 서브넷 마스크를 비트 연산, and 연산을 하면 192.168.60.0 → 네트워크 ID → 24비트

그래서 192.168.60.14/24로 표시하기도 한다.

### 4. IP 주소

#### 4-1. ARP

##### ARP : IP 주소로부터 MAC 주소를 구하는 IP와 MAC 주소의 다리 역할을 하는 프로토콜

##### RARP : MAC 주소로부터 IP 주소를 구하는 프로토콜

##### 브로드캐스트 : 송신 호스트가 전송한 데이터가 네트워크에 연결된 모든 호스트에 전송되는 방식

##### 유니캐스트 : 고유 주소로 식별된 하나의 네트워크 목적지에 1:1로 데이터를 전송하는 방식

> ARP 동작과정
> 
> 1. 송신자는 목적지 IP Adress를 지정해 ARP 요청을 브로드캐스트로 전송한다.
>   
> 2. ARP 요청의 수신처를 확인하고 자신인 경우에는 응답한다.
>   
> 3. 모든 호스트와 라우터는 수신 후 일치하면 ARP 응답을 유니캐스트로 응답한다.
>   

#### 4-2. 홉바이홉 통신

##### 홉바이홉 통신

- IP 주소를 통해 통신하는 과정
  
- 통신 장치에 있는 라우팅 테이블의 IP를 통해 시작 주소부터 시작하여 다음 IP로 계속해서 이동하는 라우팅 과정을 거쳐 패킷이 최종 목적지까지 도달하는 통신
  

##### 라우팅 테이블

- 라우터에 들어가 있는 목적지 정보들과 그 목적지로 가기위한 방법이 들어 있는 리스트
  
- 송신지에서 수신지까지 도달하기 위해 사용
  

##### 게이트웨이

- 서로 다른 통신망, 프로토콜을 사용하는 네트워크 간의 통신을 가능하게 하는 관문 역할을 하는 컴퓨터나 소프트웨어
  
- 서로 다른 네트워크상의 통신 프로토콜을 변환해주는 역할도 가능
  

#### 4-3. IP 주소 체계

##### NAT

- 패킷이 라우팅 장치를 통해 전송되는 동안 패킷의 IP 주소 정보를 수정하여 IP 주소를 다른 주소로 매핑하는 방법
  
- IPv4 주소 체계로는 많은 주소를 감당하지 못해 NAT로 공인 IP와 사설 IP로 나눠서 많은 주소 처리
  
- 공인 IP - 외부에 공개된 하나의 IP, 전 세계에서 유일
  
- 사설 IP - 하나의 네트워크에서 유일
  
- ex) 공유기 사용 인터넷 - 공유기까지 공인 IP 할당, 공유기에 연결된 네트워크 기기에는 사설 IP 할당
  

### 5. HTTP

#### 5-1. HTTP/1.0

- 기본적으로 한 연결당 하나의 요청을 처리하므로 서버로부터 하나의 파일을 가져올 때마다 TCP의 3 - 웨이 핸드셰이크를 열어서 RTT(패킷 왕복 시간) 증가
  

#### 5-2. HTTP/1.1

- 매번 TCP 연결을 하는 것이 아니라 한 번 TCP 초기화를 하고 keep-alive 옵션으로 여러 개의 파일을 송수신
  
- 그래서 TCP의 3 - 웨이 핸드셰이크가 한 번만 발생
  

#### 5-3. HTTP/2

- 지연 및 응답 시간을 줄이고 멀티플렉싱, 헤더 압축, 서버푸시를 지원하는 프로토콜
  
  - 멀티플렉싱
    
    - 여러 개의 스트림을 사용하여 송수신
      
    - 특정 스트림의 패킷이 손상되도 해당 스트림에만 영향을 미침
      
  - 헤더 압축
    
    - 허프만 코딩 알고리즘 사용
      
      - 빈도가 높은 정보는 적은 비트, 빈도가 낮은 정보는 많은 비트를 사용해서 전체 데이터에 사용되는 비트양을 줄임
        
  - 서버 푸시
    
    - 클라이언트 요청 없이 리소스 푸시 가능
      
    - html 파일을 요청하면 따로 css와 js 파일을 요청하지 않아도 html 안에 들어있는 파일들을 서버에 푸시해서 클라이언트에 전달
      

#### 5-4. HTTPS

- 애플리케이션 계층과 전송 계층 사이에 신뢰 계층인 SSL/TLS 계층을 넣은 신뢰할 수 있는 HTTP 요청
  
- 통신을 암호화
  
  - SSL/TLS
    
    - 전송 계층에서 보안을 제공하는 프로토콜
      
    - 클라이언트와 서버가 통신할 때 제3자가 도청/변조를 못하도록 막음
      

> HTTP와 HTTPS의 차이
> 
> HTTP는 클라이언트와 서버간 통신 규약이다.
> 
> HTTP로 정보를 주고 받을 경우, 제 3자에 의해 조회될 수 있다. 이러한 문제를 해결하기 위해 HTTP에 암호화가 추가된 프로토콜이 HTTPS이다. HTTPS는 암호화된 HTTP이다.
> 
> HTTP는 원래 TCP와 직접 통신했지만, HTTPS에서 HTTP는 SSL과 통신하고 SSL이 TCP와 통신함으로써 암호화된다.

#### 5-5. HTTP/3

- TCP 위에서 돌아가지 않고 QUIC 계층 위에서 UDP 기반으로 돌아감(TCP 기반 x)
  
- TCP를 사용하지 않아서 3 - 웨이 핸듯셰이크 과정 x
  
- QUIC는 첫 연결 설정에 1 - RTT만 소요되므로 클라이언트가 서버에 신호를 한 번 주고, 서버도 거기에 응답하기만 하면 통신 시작 가능
