## 쿠키/세션

### 1. 쿠키

: 클라이언트에 저장되는 key - value 형태의 작은 데이터 파일

### 1-1. 사용이유

HTTP 프로토콜은 비연결성과 비상태성이라는 특징이 있다. 모든 사용자의 요청마다 연결과 해제를 하기 때문에 연결 상태가 유지되지 않고, 상태 정보가 저장되지 않는다. 그래서 웹 사이트 재방문 시 효율적으로 서비스를 제공하기 위해 사용한다.

### 1-2. 쿠키의 동작순서

1. 웹 브라우저(웹 클라이언트)가 웹 사이트에 접속한다. - Request 발생
  
2. 서버는 브라우저에게 HTTP 응답을 전송한다. - Response 발생
  
3. 응답 헤더에 쿠키를 포함하여 전송할 경우, 서버는 쿠키를 생성하고 응답 헤더에 쿠키 정보를 추가한다.
  
4. 브라우저는 쿠키를 브라우저의 쿠키 저장소에 저장한다. 위치는 클라이언트의 로컬 디스크이고 쿠키는 텍스트 파일 형식으로 저장된다.
  
5. 이후에 같은 도메인의 웹 사이트를 방문할 때, 브라우저는 해당 도메인의 쿠키를 서버로 전송한다.
  
6. 서버는 클라이언트로부터 쿠키를 받아 사용자의 상태 정보를 유지하거나 개인 서비스를 제공한다.
  

쿠키는 도메인과 경로에 바인딩되어 있으며, 웹 사이트의 도메인과 경로가 다른 경우에는 해당 쿠키가 전송되지 않는다. 이를 "도메인 간 쿠키 전송 제한(Same-Origin Policy)"이라고 한다.

### 1-3. 쿠키가 사용되는 곳

로그인 및 장바구니, 언어 설정, 팝업창의 오늘 이 창을 다시 보지 않기

ex) 브라우저가 웹 사이트의 언어 설정을 영어에서 한국어로 바꾸면 서버는 해당 내용을 쿠키로 클라이언트에게 전송한다. 다음에 웹 사이트를 방문하면 쿠키(언어 설정이 한국어)는 요청과 함께 서버로 전송되고 서버는 쿠키의 한국어 언어 설정을 읽어서 한국어로 응답한다.

결론 - 클라이언트는 쿠키를 저장하고 서버에 전송함으로써 사용자의 상태 정보를 유지하고 웹 사이트를 개인화할 수 있다.

### 1-4. 쿠키의 특징

1. 만료 시간까지 상태 정보 유지하고 만료 시간은 서버가 설정할 수 있다.
  
2. 용량이 일반적으로 4KB로 작다.
  
3. 도메인 별로 쿠키 개수에도 제한이 있다.
  
4. 쿠키는 브라우저별로 생성된다.
  

### 1-5. 단점

쿠키는 클라이언트에 저장된다. 그래서 클라이언트 측에서 쿠키에 접근할 수 있는데 악의적인 사용자가 클라이언트의 컴퓨터에 접근해서 쿠키를 탈취할 수 있다.

<img width="329" alt="스크린샷 2024-01-14 오전 11 36 41" src="https://github.com/Woori-FISA-CS-Study/CS-Study/assets/67616146/546f8cdb-1816-478b-8981-4e9275506137">

이렇게 쿠키는 쿠키이름 = 값과 같이 key, value 형식으로 저장되기 때문에 쿠키에 저장된 정보가 노출될 수 있고 직접 변경할 수 있어서 보안에 취약하다.

그래서 쿠키와 세션을 함께 사용하는 방식이 해결책으로 제시된다.

## 2. 세션

: 웹 사이트에 이용되는 사용자 정보를 서버에 저장하는 방법

### 2-1. 사용이유

쿠키는 클라이언트 로컬 저장소에 저장되기 때문에 보안이 취약하다. 그래서 세션 id를 제외하고 나머지 정보들은 서버에 저장되기 때문에 보안을 위해 사용한다.

### 2-2. 세션의 동작순서

1. 웹 브라우저(웹 클라이언트)가 웹 사이트에 접속한다. - Request
  
2. 서버는 클라이언트에게 HTTP 응답을 전송한다. - Response
  
3. 응답 헤더에 세션 쿠키를 포함하여 전송할 경우, 서버는 세션 id를 포함한 세션 쿠키를 생성하고 응답 헤더에 세션 쿠키 정보를 추가한다.
  
4. 브라우저는 세션 쿠키를 브라우저의 쿠키 저장소에 저장합니다. 세션 쿠키는 클라이언트의 로컬 디스크에 텍스트 파일 형식으로 저장된다.
  
5. 이후에 같은 도메인의 웹 사이트를 방문할 때, 브라우저는 해당 도메인의 세션 쿠키를 서버로 전송한다. 이를 통해 세션id를 서버에 제공한다.
  
6. 서버는 클라이언트로부터 받은 세션 id를 사용하여 세션을 식별하고 상태 정보를 유지합니다. 세션 DB에서 해당 세션에 저장된 상태 정보를 읽거나 수정하는 등의 작업을 수행할 수 있다.
  
<br>
세션의 동작 방식은 쿠키와 다르게 세션 id는 서버 측에서 생성되고 관리된다. 클라이언트는 세션 id를 쿠키에 저장하여 서버에 전달하고, 서버는 세션 id를 사용하여 클라이언트를 식별하고 해당 세션과 관련된 상태 정보를 유지한다. 이를 통해 세션 기반의 사용자 상태 관리와 개인화 서비스 제공이 가능하다.

### 2-3. 세션이 사용되는 곳

로그인

ex) 첫 로그인

클라이언트가 서버에게 이메일과 패스워드를 전송한다.

이메일과 비밀번호를 확인하고 검증이 된다면 세션 DB에서 동일한 세션 id를 찾는다.

있다면, 찾은 세션 id를 그대로 반환한다.

없다면, 유저 id에 맞는 세션 id를 새로 생성하고 세션 DB에 저장하며 새로운 세션을 생성한다. 그리고 해당 세션 id를 반환한다.

### 2-4. 세션의 특징

1. 브라우저를 닫거나, 서버에서 세션을 삭제했을 때 삭제되므로 쿠키보다 보안성이 좋다.
  
2. 저장 데이터에 제한이 없다.
  
3. 각 클라이언트에 고유 세션 id를 부여해서 이것으로 식별해 각 요구에 맞는 서비스를 제공한다.
  

ex) 3번 설명 - 세션을 사용하지 않고 쿠키만 사용했을 때, 장바구니 문제

쿠키는 클라이언트 측에 저장된다.

A 클라이언트가 장바구니에 물건을 담고 B 클라이언트가 장바구니를 초기화한다면 A 클라이언트의 쿠키에 저장된 장바구니 접오는 다 사라진 상태이다. 이런 문제가 있다.

### 2-5. 단점

세션 데이터는 클라이언트와 서버 간에 주고받아야 합니다. 세션 데이터의 양이 크거나 세션 갱신이 빈번하게 발생하는 경우, 클라이언트와 서버 간의 네트워크 대역폭이 많이 사용될 수 있습니다. 이는 네트워크 지연을 초래하고, 전체적인 처리 속도를 저하시킬 수 있습니다.

> 대역폭 - 네트워크에서 한 번에 전송할 수 있는 데이터의 양

서버에서 상태 정보를 유지하기 때문에 서버 자원을 사용한다. 그래서 유저가 많아지면 저장 공간에 대한 비용이 발생한다.

### 2-6. 세션을 서버에 두는 이유

쿠키에 세션 id 외의 정보를 기록하지 않음으로써 안전성 확보

## 3. 쿠키와 세션 비교

### 공통점

- 웹 애플리케이션 사용되는 *상태 관리 기술*
  
  - 상태란 사용자에 대한 정보이고, 로그인 상태, 장바구니 설정 등이 포함
- 정보 저장과 클라이언트와 서버간의 상호작용 역할
  

### 차이점

- 사용자의 정보가 저장되는 위치, 그로 인한 보안성
  
  - 쿠키 - 서버의 자원을 사용 X
    
  - 세션 - 서버의 자원을 사용 O
    
- 라이프 사이클
  
  - 쿠키 - 파일로 저장되서 브라우저를 종료해도 정보가 유지, 만료 기간을 정해서 삭제될 때까지 유지
    
  - 세션 - 만료 기간을 설정할 수 있지만 브라우저가 종료되면 그냥 삭제
    

## 면접질문

> 1. 쿠키와 세션을 사용하는 이유가 뭘까요?
>   
>   HTTP 프로토콜의 비연결성과 비상태성이라는 특징을 보완하기 위해 사용합니다. 모든 사용자의 요청마다 연결과 해제를 하기 때문에 연결 상태가 유지되지 않고, 상태 정보가 저장되지 않습니다.쿠키는 클라이언트에 저장되어 클라이언트가 다시 접속할 때도 유지됩니다. 세션은 서버에 저장되어 클라이언트가 다시 접속하더라도 서버에서 상태를 유지할 수 있습니다. 이를 통해 로그인 상태, 장바구니 정보 등을 유지할 수 있습니다.
>   

> 2. 쿠키와 세션이 어디에 저장될까요?
>   
>   쿠키는 클라이언트, 즉 사용자의 브라우저에 저장됩니다. 일반적으로 하드 드라이브에 텍스트 파일로 저장됩니다. 세션은 서버 측에 저장됩니다. 일반적으로 서버의 메모리에 저장됩니다.
>
