## JWT

### 1. JWT

: json 객체에 인증에 필요한 정보들을 담은 후 비밀키로 서명한 토큰

### 1-1. 사용이유

세션을 사용해서 ios, 안드로이드 앱을 만들 수 있지만 쿠키는 브라우저에만 있어서 사용할 수 없다. 그래서 토큰을 사용한다. 토큰을 사용한 방법 중 하나가 JWT이다.

세션을 사용하면 클라이언트의 상태를 유지하기 위헤 서버가 세션을 저장해야 한다. JWT는 토큰 자체에 정보를 포함하고 있어, 클라이언트가 토큰을 포함시켜 요청을 보내면 서버는 토큰을 검증하여 인증과 권한을 처리할 수 있다. 이로 인해 클라이언트와 서버 간의 통신을 간소화하고, 불필요한 네트워크 부하를 줄일 수 있다.

### 1-2. JWT 토큰의 동작순서

로그인 전

1. 사용자가 아이디와 비밀번호 혹은 소셜 로그인을 이용하여 서버에 로그인 요청을 보낸다.
2. 서버는 비밀키를 사용해 json 객체를 암호화한 JWT를 발급한다.
3. JWT를 헤더에 담아 클라이언트에 보낸다.

로그인 후

1. 클라이언트는 JWT를 로컬에 저장해놓는다.
2. API 호출을 할 때마다 header에 JWT를 실어 보낸다.
3. 서버는 헤더를 매번 확인하여 사용자가 신뢰할만한지 체크하고, 인증이 되면 API에 대한 응답을 보낸다.

로그인 후에 매번 JWT를 헤더에 넣어서 보내는 매번 인증 과정을 거쳐야하는 이유는 HTTP의 특성 때문이다. 이것은 세션이 쿠키에 포함된 세션 id를 헤더에 넣어서 보내는 과정과 동일하다.

### 1-3. JWT 토큰의 특징

1. 필요한 정보를 토큰 자체에 포함하여 전달해서 서버측에서 저장이나 DB 조회 없이 토큰만으로 정보를 얻을 수 있다.
  
2. 서명을 사용하여 토큰의 무결성을 보장한다. 서버는 비밀키를 사용하여 토큰을 서명하고 서명한 정보를 , 클라이언트는 서명을 검증하여 토큰의 변조 여부를 확인할 수 있다.
  

JWT는 헤더, 페이로드, 서명 3부분으로 구성된다.

헤더는 토큰의 유형과 사용된 암호화 알고리즘을 지정한다. - json 형태

```json
{
  // 암호화에 사용된 알고리즘 
  "alg": "HS256",   
  // 토큰의 유형 
  "typ": "JWT"
}
```

페이로드는 토큰에 포함될 정보를 담는다. - json 형태

```json
{
  // 토큰의 주제 - 주로 사용자의 고유 식별자(user id)
  "sub": "1234567890",
  // 사용자의 이름 
  "name": "John Doe",
  // 토큰의 발급 시간
  "iat": 1516239022
}
```

이제 서명은 헤더와 페이로드를 사용해서 생성되고, 토큰의 무결성을 보장한다.

```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.
eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.
SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```

### 1-4. JWT 단점

JWT는 클라이언트 측에서 저장된다. 그래서 탈취당할 위험이 있기 때문에 적절한 보안 조치가 필요하다.

<br>

## 면접질문

> 1. JWT와 세션 중 JWT를 사용하는 이유가 뭘까요?
>   
>   서버의 자원을 사용하는 횟수가 세션에 비해 현저히 적고, 트래픽이 많아져 다중 서버로 늘렸을 때 문제 없이 사용할 수 있게 하기 위해서 입니다.
>
